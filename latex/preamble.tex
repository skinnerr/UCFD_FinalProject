%%
%% PACKAGES
%%

\usepackage[letterpaper, includeheadfoot, margin=0.9in,top=0.7in,bottom=0.8in]{geometry}
\usepackage[charter]{mathdesign} % Main font
\usepackage[scaled]{beramono} % Lovely monospace font
\usepackage[T1]{fontenc}
%\usepackage{amsmath, amssymb}
\usepackage{mathtools}
\usepackage{mathdots}
\usepackage{mathabx}
\usepackage{titlesec} % Custom section headings.
\usepackage{microtype}
\usepackage{xcolor}
\usepackage{xspace}
\usepackage{xfrac}
\usepackage{calc}
\usepackage{outlines}

% Page color.
\usepackage{pagecolor}
\pagecolor{white!100!black}

% Graphics.
%\usepackage{graphicx}
\usepackage[update,prepend]{epstopdf} % To use eps files.

% Code listings.
\usepackage{listings} % Code listings.
\usepackage{matlab-prettifier} % MATLAB code listings

% Tweaks for captions and enumerations.
\usepackage[labelfont=bf]{caption} % Figure captions.
\usepackage{enumitem} % Fine tuning enumerations.
%\usepackage{floatrow} % Captions to the right of figures.

% Plotting and drawing
\usepackage{tikz} % This automatically loads graphicx!
\usetikzlibrary{calc} % For relative positions to defined coords
\usepackage{pgfplots} % Scientific plotting tools
\pgfplotsset{compat=1.7}

% Figure placement
%\usepackage{wrapfig}
%\captionsetup[wrapfigure]{margin=0.5cm}

% Packages to makes tables pretty.
\usepackage{array}
\usepackage{booktabs}
\setlength{\heavyrulewidth}{1.5pt}
\setlength{\abovetopsep}{4pt}
\renewcommand{\arraystretch}{1.2}

% Fancyhdr package stuff...
\usepackage{fancyhdr}
\setlength{\headheight}{30pt}
%\renewcommand{\headrulewidth}{0pt}
%\renewcommand{\footrulewidth}{0pt}

%%
%% SETTINGS
%%

% Path to look for graphics
\graphicspath{{../images/}}
%\epstopdfsetup{outdir=../images/}

% Caption spacing
\setlength{\abovecaptionskip}{0pt}

% List spacing
\setlist{noitemsep}

% Math operator font
\DeclareSymbolFont{sfoperators}{OT1}{cmss}{m}{n}
\DeclareSymbolFontAlphabet{\mathsf}{sfoperators}
\makeatletter
\def\operator@font{\mathgroup\symsfoperators}
\makeatother

%% No indent all paragraphs
%\setlength{\parindent}{0in}

% Figure references
\newcommand{\figref}[1]{Figure~\ref{#1}}

% Special format section headings
\titleformat{\section}%
	{\large\bf\scshape}% Text formatting
	{\arabic{section}}% Number
	{1em}% Space between number and text
	{}% Code before
	[]% Code after
\titleformat{\subsection}%
	{\normalsize\bf\scshape}% Text formatting
	{\arabic{section}.\arabic{subsection}}% Number
	{1em}% Space between number and text
	{}% Code before
	[]% Code after
%\titleformat{\subsubsection}%
%	{\color{blue}}% Text formatting
%	{\arabic{subsubsection} $\rightarrow$}% Number
%	{1em}% Space between number and text
%	{}% Code before
%	[]% Code after

%\definecolor{mygray}{rgb}{0.4, 0.4, 0.4}
%\lstset{
%style=Matlab-editor,
%mlscaleinline=false,
%basicstyle=\ttfamily\lst@ifdisplaystyle\scriptsize\fi,
%frame=single,
%rulecolor=\color{mygray},
%numbers=left,
%numbersep=10pt,
%numberstyle=\footnotesize \ttfamily \color{mygray},
%xleftmargin=30pt,
%xrightmargin=5pt,
%framexleftmargin=4pt,
%framextopmargin=2pt
%}
\lstset{
basicstyle=\ttfamily\color{cyan!60!black}\small,
tabsize=3
}

% Allow white-space to be eaten within any lst environments between returns.
\lstset{breaklines,breakatwhitespace}

% Define a chacacter as shorthand for inline listings.
\lstMakeShortInline[basicstyle=\ttfamily\color{cyan!60!black}\small]{|}

%%
%% COMMANDS
%%

% Various plot lines to include in-line.
\newcommand{\solidrule}[1][8mm]{\rule[0.5ex]{#1}{1.5pt}}
\newcommand{\dashrule}{\mbox{%
	\solidrule[2mm]\hspace{1mm}\solidrule[2mm]\hspace{1mm}\solidrule[2mm]}}
\newcommand{\dotdashrule}{\mbox{%
	\solidrule[0.5mm]\hspace{1mm}\solidrule[2mm]\hspace{1mm}\solidrule[0.5mm]\hspace{1mm}\solidrule[2mm]}}

% Automated file inclusion for code listings
\makeatletter
\def\includecode{\@ifnextchar[{\@with}{\@without}}
\def\@with[#1]#2{
}
\def\@without#1{
  \lstinputlisting[caption=\ttfamily\protect\detokenize{#1}, escapechar=, frame=single]{../matlab_code/#1}
}
\makeatother

% Degree symbol.
% \newcommand{\degree}{\ensuremath{^\circ}}

% Red asterisk.
\newcommand{\ra}{{\bfseries\color{red}*}\hspace{0.5ex}}

% Superscript text: 1st, 2nd, 3rd, 4th
\newcommand{\suptext}[1]{\ensuremath{^\text{#1}}\xspace}
\newcommand{\st}{\suptext{st}}
\newcommand{\nd}{\suptext{nd}}
\newcommand{\rd}{\suptext{rd}}
\let\oldth\th % Reassign the current \th command
\renewcommand{\th}{\suptext{th}}

% Underline matrices
%\newcommand{\ul}[1]{\smash{\underline{#1}}}
%\newcommand{\uul}[1]{\smash{\underline{\underline{#1}}}}
\newcommand{\ul}[1]{\underline{#1}}
\newcommand{\uul}[1]{\underline{\underline{#1}}}

% Overset and underset with phantom to allow expected super- and sub-scripts
\newcommand{\oset}[2]{\overset{#1}{#2}\vphantom{#2}}
\newcommand{\uset}[2]{\underset{#1}{#2}\vphantom{#2}}

% Partial derivatives
\newcommand{\pp}[2]{\ensuremath{\frac{\partial#1}{\partial#2}}}

% Error function
\DeclareMathOperator\erf{erf}

% Big O notation
\newcommand{\bigo}{\ensuremath{\mathcal{O}}}

% Text max and min
\newcommand{\tmax}{\ensuremath{\text{max}}}
\newcommand{\tmin}{\ensuremath{\text{min}}}

% Norm
\newcommand{\norm}[1]{\ensuremath{\left| #1 \right|}}

% Bold vectors
% Option 1: Works on more than single tokens, but makes regular letters italic as well as bold.
%\renewcommand{\vec}[1]{\mathbold{#1}}
% Option 2: Only works if a single token is passed to the command, but makes regular letters bold only.
\newcommand{\mb}[1]{
	\ifcat\noexpand#1\relax
		\expandafter\mathbold
	\else
		\expandafter\mathbf
	\fi{{#1}}
}

% Underlines for tensor notation.
\newcommand{\tsr}[1]{\ensuremath{\underline{#1}}}
\newcommand{\tsrr}[1]{\ensuremath{\underline{\underline{#1}}}}

% Allow lstinline within math mode. At bottom of this file b/c of syntax highlighting.
%\usepackage{letltxmacro}
%\newcommand*{\SavedLstInline}{}
%\LetLtxMacro\SavedLstInline\lstinline
%\DeclareRobustCommand*{\lstinline}{%
%  \ifmmode
%    \let\SavedBGroup\bgroup
%    \def\bgroup{%
%      \let\bgroup\SavedBGroup
%      \hbox\bgroup
%    }%
%  \fi
%  \SavedLstInline
%}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% OUTLINE %%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Basically augmenting the "outlines" package.
% Source: http://tex.stackexchange.com/questions/262721/increasing-the-maximum-number-of-enumerate-environments
% NOTE: LATEX CAN ONLY HAVE 6 LEVELS IN LISTS. This in NOT negotiable; hard-coded into latex.

\makeatletter
\newcommand{\outlinev}{\ol@type}
\newcommand{\outlinevi}{\ol@type}
\newcommand{\ol@incv}{\begin{\outlinev}}
\newcommand{\ol@decv}{\end{\outlinev}}
\newcommand{\ol@incvi}{\begin{\outlinevi}}
\newcommand{\ol@decvi}{\end{\outlinevi}}
\newcommand{\ol@tov}{}
\newcommand{\ol@tovi}{}
\renewcommand{\ol@commands}[7]{%
  \renewcommand{\ol@toz}{#1}%
  \renewcommand{\ol@toi}{#2}%
  \renewcommand{\ol@toii}{#3}%
  \renewcommand{\ol@toiii}{#4}%
  \renewcommand{\ol@toiiii}{#5}%
  \renewcommand{\ol@tov}{#6}%
  \renewcommand{\ol@tovi}{#7}%
}
\renewcommand{\ol@exit}{%
  \ol@commands{}{}{}{}{}{}{}}
\renewcommand{\ol@z}{%
  \ol@commands%
    {}%
    {\ol@inci}%
    {\ol@inci\ol@incii}%
    {\ol@inci\ol@incii\ol@inciii}%
    {\ol@inci\ol@incii\ol@inciii\ol@inciiii}%
    {\ol@inci\ol@incii\ol@inciii\ol@inciiii\ol@incv}%
    {\ol@inci\ol@incii\ol@inciii\ol@inciiii\ol@incv\ol@incvi}}
\renewcommand{\ol@i}{%
  \ol@commands%
    {\ol@deci}%
    {}%
    {\ol@incii}%
    {\ol@incii\ol@inciii}%
    {\ol@incii\ol@inciii\ol@inciiii}%
    {\ol@incii\ol@inciii\ol@inciiii\ol@incv}%
    {\ol@incii\ol@inciii\ol@inciiii\ol@incv\ol@incvi}}
\renewcommand{\ol@ii}{%
  \ol@commands%
    {\ol@decii\ol@deci}%
    {\ol@decii}%
    {}%
    {\ol@inciii}%
    {\ol@inciii\ol@inciiii}%
    {\ol@inciii\ol@inciiii\ol@incv}%
    {\ol@inciii\ol@inciiii\ol@incv\ol@incvi}}
\renewcommand{\ol@iii}{%
  \ol@commands%
    {\ol@deciii\ol@decii\ol@deci}%
    {\ol@deciii\ol@decii}%
    {\ol@deciii}%
    {}%
    {\ol@inciiii}%
    {\ol@inciiii\ol@incv}%
    {\ol@inciiii\ol@incv\ol@incvi}}
\renewcommand{\ol@iiii}{%
  \ol@commands%
    {\ol@deciiii\ol@deciii\ol@decii\ol@deci}%
    {\ol@deciiii\ol@deciii\ol@decii}%
    {\ol@deciiii\ol@deciii}%
    {\ol@deciiii}%
    {}%
    {\ol@incv}%
    {\ol@incv\ol@incvi}}
\newcommand{\ol@v}{%
  \ol@commands%
    {\ol@decv\ol@deciiii\ol@deciii\ol@decii\ol@deci}%
    {\ol@decv\ol@deciiii\ol@deciii\ol@decii}%
    {\ol@decv\ol@deciiii\ol@deciii}%
    {\ol@decv\ol@deciiii}%
    {\ol@decv}%
    {}%
    {\ol@incvi}}
\newcommand{\ol@vi}{%
  \ol@commands%
    {\ol@decvi\ol@decv\ol@deciiii\ol@deciii\ol@decii\ol@deci}%
    {\ol@decvi\ol@decv\ol@deciiii\ol@deciii\ol@decii}%
    {\ol@decvi\ol@decv\ol@deciiii\ol@deciii}%
    {\ol@decvi\ol@decv\ol@deciiii}%
    {\ol@decvi\ol@decv}%
    {\ol@decvi}%
    {}}

\renewenvironment{outline}[1][]{%
  \ifthenelse{\equal{#1}{}}{}{\renewcommand{\ol@type}{#1}}%
  \ol@z%
  \newcommand{\0}{\ol@toz\ol@z}%
  \newcommand{\1}{\ol@toi\ol@i\item}%
  \newcommand{\2}{\ol@toii\ol@ii\item}%
  \newcommand{\3}{\ol@toiii\ol@iii\item}%
  \newcommand{\4}{\ol@toiiii\ol@iiii\item}%
  \newcommand{\5}{\ol@tov\ol@v\item}%
  \newcommand{\6}{\ol@tovi\ol@vi\item}%
}{%
  \ol@toz\ol@exit%
}
\makeatother

\newlist{deep}{enumerate}{6}

\setlist[deep,1]{label=$\blacksquare$}
\setlist[deep,2]{label=$\square$}
\setlist[deep,3]{label=$\bullet$}
\setlist[deep,4]{label=$\circ$}
\setlist[deep,5]{label=$\blacktriangleright$}
\setlist[deep,6]{label=$\smalltriangleright$}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% END OUTLINE %%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Allow usage of \ttfamily in math mode (for lstinline inside math)
\usepackage{letltxmacro}
\newcommand*{\SavedLstInline}{}
\LetLtxMacro\SavedLstInline\lstinline
\DeclareRobustCommand*{\lstinline}{%
  \ifmmode
    \let\SavedBGroup\bgroup
    \def\bgroup{%
      \let\bgroup\SavedBGroup
      \hbox\bgroup
    }%
  \fi
  \SavedLstInline
}